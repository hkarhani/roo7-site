<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="page-title">My Invoices</title>
  <script type="module" src="frontend-config.js"></script>
  <link rel="stylesheet" href="dashboard.css?v=5.4" />
  <link rel="stylesheet" href="invoices.css?v=2.3" />
</head>
<body>
  <div class="dashboard-header">
    <h1>📄 My Invoices</h1>

    <div class="actions">
      <a href="user-guide.html#invoices" target="_blank" style="color: #0077cc; text-decoration: none; padding: 8px 14px; background: #fff; border: 2px solid #0077cc; border-radius: 6px; font-size: 14px; margin-right: 10px;">
        📚 Help
      </a>
      <button id="export-invoices-btn">📊 Export</button>
      <button id="toggle-theme">Toggle Theme</button>
      <button id="back-to-dashboard">← Dashboard</button>
    </div>
  </div>

  <main class="dashboard-grid invoices-grid">
    <!-- Invoice Summary Section -->
    <section id="section-summary" class="dashboard-card">
      <h2>📊 Invoice Summary</h2>
      <div class="summary-stats">
        <div class="stat-card">
          <div class="stat-label">Total Paid</div>
          <div id="total-paid" class="stat-value positive">$0.00</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Outstanding</div>
          <div id="total-outstanding" class="stat-value warning">$0.00</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Invoices</div>
          <div id="total-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">7-Day Avg AUM</div>
          <div id="current-aum" class="stat-value">$0.00</div>
        </div>
      </div>
    </section>

    <!-- Unified Pricing Information -->
    <section id="section-unified-pricing" class="dashboard-card">
      <h2>💰 Current Pricing (2025 Model)</h2>
      
      <div class="pricing-explanation">
        <div class="pricing-tier-info">
          <h3>One Plan. Unlimited Accounts.</h3>
          <p>Your subscription covers all linked trading accounts with simple, transparent pricing based on your total AUM.</p>
        </div>
        
        <div class="pricing-calculator">
          <div class="pricing-breakdown">
            <div class="pricing-row">
              <span class="label">Your 7-Day Average AUM:</span>
              <span class="value" id="user-aum-display">$0.00</span>
            </div>
            <div class="pricing-row">
              <span class="label">Base Annual Fee:</span>
              <span class="value" id="base-fee-display">$0.00</span>
            </div>
            <div class="pricing-row referral-savings" id="referral-savings-row" style="display: none;">
              <span class="label">🎯 With Referral Code:</span>
              <span class="value savings" id="referral-fee-display">$0.00 (Save $0)</span>
            </div>
          </div>
          
          <div class="pricing-examples">
            <h4>Pricing Examples:</h4>
            <table class="pricing-table">
              <thead>
                <tr>
                  <th>7-Day Avg AUM</th>
                  <th>Base Price</th>
                  <th>With Referral</th>
                  <th>You Save</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>$6,000</td>
                  <td>$600/year</td>
                  <td>$500/year</td>
                  <td>$100</td>
                </tr>
                <tr>
                  <td>$10,000</td>
                  <td>$720/year</td>
                  <td>$600/year</td>
                  <td>$120</td>
                </tr>
                <tr>
                  <td>$25,000</td>
                  <td>$1,800/year</td>
                  <td>$1,500/year</td>
                  <td>$300</td>
                </tr>
                <tr>
                  <td>$100,000</td>
                  <td>$7,200/year</td>
                  <td>$6,000/year</td>
                  <td>$1,200</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="referral-code-input">
          <h4>🎯 Have a Referral Code?</h4>
          <p>Save 20% on your subscription with a referral code!</p>
          <div class="referral-input-group">
            <input type="text" id="referral-code-input" placeholder="Enter referral code">
            <button id="apply-referral-btn" class="referral-btn">Apply Code</button>
          </div>
          <div id="referral-message" class="referral-feedback"></div>
        </div>
      </div>
    </section>

    <!-- Combined Subscription Management Section -->
    <section id="section-subscription-management" class="dashboard-card" style="display: none;">
      <h2>🚀 Subscription Management & Quick Actions</h2>
      
      <!-- Top Row: Quick Actions (similar to filter controls style) -->
      <div class="subscription-controls">
        <div class="quick-actions-group">
          <h4>⚡ Quick Actions</h4>
          <div class="quick-actions-buttons">
            <button id="view-subscription-btn" class="action-btn info">
              <span class="btn-icon">📋</span>
              <span class="btn-text">View Subscription Details</span>
            </button>
            <button id="payment-help-btn" class="action-btn help">
              <span class="btn-icon">❓</span>
              <span class="btn-text">Payment Help</span>
            </button>
          </div>
        </div>
        
        <div class="invoice-request-group">
          <h4>📄 Request New Invoice</h4>
          <div class="invoice-request-buttons">
            <button id="request-invoice-btn" class="action-btn primary">
              <span class="btn-icon">📄</span>
              <span class="btn-text">Request Invoice</span>
            </button>
            <button id="activate-with-pricing-btn" class="action-btn success" style="display: none;">
              <span class="btn-icon">🚀</span>
              <span class="btn-text">Activate Subscription</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Main Content: Invoice Request Flow -->
      <div class="invoice-request-content">
        <div class="activation-message">
          <p>Request a subscription invoice with automatic account analysis and current portfolio valuation.</p>
        </div>
        
        <div class="auto-troubleshoot-info" id="auto-troubleshoot-info" style="display: none;">
          <h4>🔄 Account Analysis Results</h4>
          <div id="auto-troubleshoot-details"></div>
        </div>
        
        <div class="preliminary-invoice" id="preliminary-invoice" style="display: none;">
          <h4>📋 Invoice Preview</h4>
          <div id="invoice-preview-details"></div>
        </div>
        
        <div class="new-referral-section" id="new-referral-section" style="display: none;">
          <h4>🎯 Apply Referral Code (Optional)</h4>
          <p class="referral-help">Enter a referral code to get additional discounts on your subscription.</p>
          <div class="referral-input-group">
            <input type="text" id="new-referral-code" placeholder="Enter referral code for discounts">
            <button id="validate-new-referral-btn" class="validate-btn">Validate & Apply Discount</button>
          </div>
          <div id="new-referral-message" class="referral-message"></div>
        </div>
        
        <div class="updated-pricing" id="updated-pricing" style="display: none;">
          <h4>💰 Updated Pricing</h4>
          <div id="updated-pricing-details"></div>
        </div>
      </div>
    </section>

    <!-- Invoices Table Section with Integrated Filters -->
    <section id="section-invoices" class="dashboard-card">
      <h2>📄 Invoice History & Filters</h2>
      
      <!-- Integrated Filter Controls -->
      <div class="filter-controls">
        <div class="filter-group">
          <label for="status-filter">Status:</label>
          <select id="status-filter">
            <option value="">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="paid">Paid</option>
            <option value="overdue">Overdue</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="type-filter">Type:</label>
          <select id="type-filter">
            <option value="">All Types</option>
            <option value="initial">Initial</option>
            <option value="renewal">Renewal</option>
            <option value="manual">Manual</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="date-from">From:</label>
          <input type="date" id="date-from">
        </div>
        
        <div class="filter-group">
          <label for="date-to">To:</label>
          <input type="date" id="date-to">
        </div>
        
        <button id="apply-filters" class="filter-btn">Apply Filters</button>
        <button id="clear-filters" class="filter-btn secondary">Clear</button>
      </div>

      <div class="table-container">
        <table id="invoices-table">
          <thead>
            <tr>
              <th>Invoice ID</th>
              <th>Date</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Type</th>
              <th>Due Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="7" class="loading-message">Loading invoices...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Invoice Details Modal -->
  <div id="invoice-modal" class="modal">
    <div class="modal-content invoice-modal-content">
      <span class="close" id="close-invoice-modal">&times;</span>
      <h3 id="modal-title">Invoice Details</h3>
      
      <div id="invoice-details" class="invoice-details">
        <!-- Invoice details will be populated here -->
      </div>
      
      <div class="modal-actions">
        <button id="download-invoice" class="action-btn primary">📥 Download</button>
        <button id="print-invoice" class="action-btn secondary">🖨️ Print</button>
      </div>
    </div>
  </div>

  <!-- Payment Help Modal -->
  <div id="payment-help-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close-help-modal">&times;</span>
      <h3>💳 Payment Information</h3>
      
      <div class="help-content">
        <div class="help-section">
          <h4>🔗 Accepted Payment Methods</h4>
          <ul>
            <li>💳 Credit/Debit Card (Visa, MasterCard, Amex)</li>
            <li>🏦 Bank Transfer (Wire Transfer)</li>
            <li>💰 Stablecoins (USDT, USDC) at payment-day FX rates</li>
            <li>🪙 Cryptocurrency (BTC, ETH)</li>
          </ul>
        </div>
        
        <div class="help-section">
          <h4>💰 2025 Pricing Model</h4>
          <ul>
            <li><strong>Under $10k AUM:</strong> $600/year (or $500 with referral)</li>
            <li><strong>$10k+ AUM:</strong> 7.2%/year (or 6% with referral)</li>
            <li><strong>AUM Calculation:</strong> 7-day trailing average</li>
            <li><strong>Billing:</strong> Annual, upfront payment</li>
          </ul>
        </div>
        
        <div class="help-section">
          <h4>🔄 Refund Policy</h4>
          <ul>
            <li><strong>14-Day Cooling-Off:</strong> Full refund within 14 days</li>
            <li><strong>After 14 Days:</strong> No prorated refunds</li>
            <li><strong>Annual Terms:</strong> Price fixed for the year</li>
            <li><strong>Renewal:</strong> Re-rated based on new 7-day AUM average</li>
          </ul>
        </div>
        
        <div class="help-section">
          <h4>📞 Need Help?</h4>
          <p>For payment assistance, please contact our support team:</p>
          <ul>
            <li>📧 Email: <span id="billing-email">billing@roo7.site</span></li>
            <li>💬 Live Chat: Available 24/7</li>
            <li>📱 Phone: <span id="support-phone">+1-800-ROO7-HELP</span></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="theme-manager.js?v=1"></script>
  <script type="module">
    import CONFIG from './frontend-config.js';
    
    // Update page title and support contact info
    document.getElementById('page-title').textContent = CONFIG.PAGE_CONFIG.titles.invoices;
    
    // Update billing email when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      const billingEmailEl = document.getElementById('billing-email');
      const supportPhoneEl = document.getElementById('support-phone');
      
      if (billingEmailEl) {
        billingEmailEl.textContent = CONFIG.EMAIL_CONFIG.support;
      }
      if (supportPhoneEl) {
        supportPhoneEl.textContent = `+1-800-${CONFIG.BRAND_CONFIG.name}-HELP`;
      }
    });
  </script>
  <script type="module" src="invoices.js?v=2.4"></script>
</body>
</html>