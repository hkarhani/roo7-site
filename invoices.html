<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="page-title">My Invoices</title>
  <script type="module" src="frontend-config.js"></script>
  <link rel="stylesheet" href="dashboard.css?v=5.4" />
  <link rel="stylesheet" href="invoices.css?v=2.0" />
</head>
<body>
  <div class="dashboard-header">
    <h1>📄 My Invoices</h1>

    <div class="actions">
      <button id="export-invoices-btn">📊 Export</button>
      <button id="toggle-theme">Toggle Theme</button>
      <button id="back-to-dashboard">← Dashboard</button>
    </div>
  </div>

  <main class="dashboard-grid invoices-grid">
    <!-- Invoice Summary Section -->
    <section id="section-summary" class="dashboard-card">
      <h2>📊 Invoice Summary</h2>
      <div class="summary-stats">
        <div class="stat-card">
          <div class="stat-label">Total Paid</div>
          <div id="total-paid" class="stat-value positive">$0.00</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Outstanding</div>
          <div id="total-outstanding" class="stat-value warning">$0.00</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Invoices</div>
          <div id="total-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Current Tier</div>
          <div id="current-tier" class="stat-value">N/A</div>
        </div>
      </div>
    </section>

    <!-- Invoice Filters Section -->
    <section id="section-filters" class="dashboard-card">
      <h2>🔍 Filters</h2>
      <div class="filter-controls">
        <div class="filter-group">
          <label for="status-filter">Status:</label>
          <select id="status-filter">
            <option value="">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="paid">Paid</option>
            <option value="overdue">Overdue</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="type-filter">Type:</label>
          <select id="type-filter">
            <option value="">All Types</option>
            <option value="initial">Initial</option>
            <option value="renewal">Renewal</option>
            <option value="manual">Manual</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="date-from">From:</label>
          <input type="date" id="date-from">
        </div>
        
        <div class="filter-group">
          <label for="date-to">To:</label>
          <input type="date" id="date-to">
        </div>
        
        <button id="apply-filters" class="filter-btn">Apply Filters</button>
        <button id="clear-filters" class="filter-btn secondary">Clear</button>
      </div>
    </section>

    <!-- NEW: Invoice Request Section -->
    <section id="section-invoice-request" class="dashboard-card" style="display: none;">
      <h2>📄 Request Subscription Invoice</h2>
      <div class="invoice-request-content">
        <div class="activation-message">
          <p>Request a subscription invoice with automatic account analysis and current portfolio valuation.</p>
        </div>
        
        <div class="auto-troubleshoot-info" id="auto-troubleshoot-info" style="display: none;">
          <h4>🔄 Account Analysis Results</h4>
          <div id="auto-troubleshoot-details"></div>
        </div>
        
        <div class="preliminary-invoice" id="preliminary-invoice" style="display: none;">
          <h4>📋 Invoice Preview</h4>
          <div id="invoice-preview-details"></div>
        </div>
        
        <div class="new-referral-section" id="new-referral-section" style="display: none;">
          <h4>🎯 Apply Referral Code (Optional)</h4>
          <p class="referral-help">Enter a referral code to get additional discounts on your subscription.</p>
          <div class="referral-input-group">
            <input type="text" id="new-referral-code" placeholder="Enter referral code for discounts">
            <button id="validate-new-referral-btn" class="validate-btn">Validate & Apply Discount</button>
          </div>
          <div id="new-referral-message" class="referral-message"></div>
        </div>
        
        <div class="updated-pricing" id="updated-pricing" style="display: none;">
          <h4>💰 Updated Pricing</h4>
          <div id="updated-pricing-details"></div>
        </div>
        
        <div class="invoice-request-actions">
          <button id="request-invoice-btn" class="action-btn primary">
            <span class="btn-icon">📄</span>
            <span class="btn-text">Request Invoice</span>
          </button>
          <button id="activate-with-pricing-btn" class="action-btn success" style="display: none;">
            <span class="btn-icon">🚀</span>
            <span class="btn-text">Activate Subscription</span>
          </button>
        </div>
      </div>
    </section>


    <!-- Invoice Actions Section -->
    <section id="section-actions" class="dashboard-card">
      <h2>⚡ Quick Actions</h2>
      <div class="action-buttons">
        <button id="view-subscription-btn" class="action-btn info">
          <span class="btn-icon">📋</span>
          <span class="btn-text">View Subscription Details</span>
        </button>
        <button id="payment-help-btn" class="action-btn help">
          <span class="btn-icon">❓</span>
          <span class="btn-text">Payment Help</span>
        </button>
      </div>
    </section>

    <!-- Invoices Table Section -->
    <section id="section-invoices" class="dashboard-card">
      <h2>📄 Invoice History</h2>
      <div class="table-container">
        <table id="invoices-table">
          <thead>
            <tr>
              <th>Invoice ID</th>
              <th>Date</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Type</th>
              <th>Due Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="7" class="loading-message">Loading invoices...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Invoice Details Modal -->
  <div id="invoice-modal" class="modal">
    <div class="modal-content invoice-modal-content">
      <span class="close" id="close-invoice-modal">&times;</span>
      <h3 id="modal-title">Invoice Details</h3>
      
      <div id="invoice-details" class="invoice-details">
        <!-- Invoice details will be populated here -->
      </div>
      
      <div class="modal-actions">
        <button id="download-invoice" class="action-btn primary">📥 Download</button>
        <button id="print-invoice" class="action-btn secondary">🖨️ Print</button>
      </div>
    </div>
  </div>

  <!-- Payment Help Modal -->
  <div id="payment-help-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close-help-modal">&times;</span>
      <h3>💳 Payment Information</h3>
      
      <div class="help-content">
        <div class="help-section">
          <h4>🔗 Accepted Payment Methods</h4>
          <ul>
            <li>Bank Transfer (Wire Transfer)</li>
            <li>Cryptocurrency (BTC, ETH, USDT)</li>
            <li>Credit/Debit Card (Visa, MasterCard)</li>
            <li>PayPal (for certain regions)</li>
          </ul>
        </div>
        
        <div class="help-section">
          <h4>📞 Need Help?</h4>
          <p>For payment assistance, please contact our support team:</p>
          <ul>
            <li>📧 Email: <span id="billing-email">billing@roo7.site</span></li>
            <li>💬 Live Chat: Available 24/7</li>
            <li>📱 Phone: <span id="support-phone">+1-800-ROO7-HELP</span></li>
          </ul>
        </div>
        
        <div class="help-section">
          <h4>⏰ Payment Terms</h4>
          <ul>
            <li>Payment due within 30 days of invoice date</li>
            <li>Late fees may apply after due date</li>
            <li>Automatic suspension after 60 days overdue</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="theme-manager.js?v=1"></script>
  <script type="module">
    import CONFIG from './frontend-config.js';
    
    // Update page title and support contact info
    document.getElementById('page-title').textContent = CONFIG.PAGE_CONFIG.titles.invoices;
    
    // Update billing email when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      const billingEmailEl = document.getElementById('billing-email');
      const supportPhoneEl = document.getElementById('support-phone');
      
      if (billingEmailEl) {
        billingEmailEl.textContent = CONFIG.EMAIL_CONFIG.support;
      }
      if (supportPhoneEl) {
        supportPhoneEl.textContent = `+1-800-${CONFIG.BRAND_CONFIG.name}-HELP`;
      }
    });
  </script>
  <script type="module" src="invoices.js?v=2.1"></script>
</body>
</html>